!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Nonogram=t():e.Nonogram=t()}(window,function(){return function(e){var t={};function l(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,l),n.l=!0,n.exports}return l.m=e,l.c=t,l.d=function(e,t,o){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(l.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)l.d(o,n,function(t){return e[t]}.bind(null,n));return o},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="dist/",l(l.s=1)}([function(e,t){},function(e,t,l){l(0),l(2),l(3),l(4),l(5),l(6),l(7),l(8),l(9),e.exports=l(10)},function(e,t,l){"use strict";l.r(t);var o=l(0),n=l.n(o);n.a.Puzzle=class{constructor(e,t){if(e<=0||t<=0||1===e&&1===t)throw"invalid dimensions: "+e.toString()+" x "+t.toString();this.width="number"==typeof e?e:parseInt(e.toString(),10),this.height="number"==typeof t?t:parseInt(t.toString(),10),this.totalCells=this.width*this.height,this.reset()}reset(){const e=n.a.Utility.getZeroFilledArray;this.creator=null,this.cells=[],this.rowHints=[],this.columnHints=[],this.grid=e(this.height).map(()=>e(this.width))}createFromGrid(e){const t=this;let l,o,i,s,r,a;for(t.reset(),t.grid=e,t.grid.forEach(function(e,l){e.forEach(function(e,o){t.cells.push(new n.a.PuzzleCell({index:l*t.width+o,column:o,row:l,solution:e}))})}),t.grid.forEach((e,l)=>{let o=[];t.rowHints[l]=[],e.forEach((e,n)=>{const i=e,s=n>0?t.grid[l][n-1]:0;1===i&&0===s?o.push(1):0===i&&1===s?o.push(0):1===i&&1===s&&o[o.length-1]++}),o.forEach(e=>{e>0&&t.rowHints[l].push(e)})}),i=0;i<t.width;i++){for(t.columnHints[i]=[],l=[],s=i;s<t.totalCells;s+=t.width)o=Math.floor(s/t.width),r=t.grid[o][i],a=o>0?t.grid[o-1][i]:0,1===r&&0===a?l.push(1):0===r&&1===a?l.push(0):1===r&&1===a&&l[l.length-1]++;l.forEach(e=>{e>0&&t.columnHints[i].push(e)})}}createFromHints(e){const t=this;t.reset(),t.rowHints=e.row,t.columnHints=e.column,t.grid.forEach((e,l)=>{e.forEach((e,o)=>{t.cells.push(new n.a.PuzzleCell({index:l*t.width+o,column:o,row:l}))})})}checkUserSolution(){return this.cells.every(e=>{const t=1===e.userSolution?1:0;return e.solution===t})}getRowCells(e){const t=[];return this.cells.forEach(l=>{l.row===e&&t.push(l)}),t.length>0&&t}getColumnCells(e){const t=[];return this.cells.forEach(l=>{l.column===e&&t.push(l)}),t.length>0&&t}getCellByIndex(e){const t="number"!=typeof e?parseInt(e,10):e;return!!this.cells[t]&&this.cells[t]}}},function(e,t,l){"use strict";l.r(t);var o=l(0);l.n(o).a.PuzzleCell=class{constructor(e){this.index=null,this.column=null,this.row=null,this.solution=null,this.userSolution=null,this.aiSolution=null,Object.assign(this,e)}}},function(e,t,l){"use strict";l.r(t);var o=l(0);l.n(o).a.PuzzleLine=class{constructor(e){this.type=null,this.index=null,this.length=null,this.minimumSectionLength=0,this.sections=[],this.cells=[],this.solved=!1,Object.assign(this,e)}}},function(e,t,l){"use strict";l.r(t);var o=l(0);l.n(o).a.Utility=class{static removeFromArray(e,t){const l=e.indexOf(t);return-1!==l&&e.splice(l,1),e}static getZeroFilledArray(e){return new Array(e).fill(0)}static cloneArray(e){return e.slice(0)}static getRandomIntBetween(e,t){let l=Math.ceil(e),o=Math.floor(t);return Math.floor(Math.random()*(o-l+1))+l}}},function(e,t,l){"use strict";l.r(t);var o=l(0),n=l.n(o);n.a.Creator=class{constructor(e,t){this.puzzle=new n.a.Puzzle(e,t),this.log=[]}createRandom(e){const t=(new Date).getTime();let l,o,i,s,r,a,c,u,d=!1,h="number"==typeof e&&e>=0&&e<=1;for(;!1===d;){for(o=h?e:n.a.Utility.getRandomIntBetween(200,800)/1e3,i=[],s=[],l=0,this.log.push("Creating random "+this.puzzle.width+"x"+this.puzzle.height+" puzzle with density of "+o+"..."),c=0;c<this.puzzle.totalCells;c++)l+=r=Math.random()<o?1:0,c%this.puzzle.width==0&&c>0&&(i.push(s),s=[]),s.push(r);0!==l?l!==this.puzzle.totalCells?(i.push(s),this.puzzle.createFromGrid(i),(a=new n.a.Solver(this.puzzle)).solve()?(d=!0,u=((new Date).getTime()-t)/1e3,this.log.push("Puzzle is solvable."),this.log.push("-----------------------------------"),this.log.push("Puzzle generated in "+u+" seconds.")):this.log.push("Puzzle cannot be solved.  Trying again..."),this.log.push("-----------------------------------")):this.log.push("Generated puzzle has all cells filled.  Trying again..."):this.log.push("Generated puzzle has no cells filled.  Trying again...")}return this.puzzle.creator=this,this.puzzle}}},function(e,t,l){"use strict";l.r(t);var o=l(0),n=l.n(o);n.a.Solver=class{constructor(e){this.puzzle=e,this._reset()}solve(){const e=this,t=(new Date).getTime();let l,o,n,i,s,r,a=-1,c=1;for(e.isReset||e._reset(),e.isReset=!1,e.log("Starting solve algorithm","info");e.getProgress()>a&&e.getTotalSolved()<e.puzzle.cells.length;)o=(new Date).getTime(),a=e.getProgress(),e.lines.forEach(t=>{t.solved||(e.eliminateImpossibleFits(t),e.findKnownPositivesAndNegatives(t),e.findSectionDefiningChains(t),e.findAnchoredSections(t),e.findCompletedSections(t),e.findCompletedLines(t))}),s=((n=(new Date).getTime())-o)/1e3,e.log("Pass "+c+" completed in "+s+" seconds :: "+e.getTotalSolved()+"/"+e.puzzle.cells.length+" cells solved","info"),c++;return l=e.getTotalSolved()===e.puzzle.cells.length,r=((i=(new Date).getTime())-t)/1e3,e.log("Solve algorithm finished in "+r+" seconds.","info"),l?e.log("Solution Found.","success"):e.log("Could not find solution.","failure"),l}eliminateImpossibleFits(e){const t=this;let l,o=0,i=e.length-e.minimumSectionLength;for(0===e.sections.length&&e.cells.forEach(e=>{t.setCellSolution(e,0)}),l=0;l<e.length&&0===e.cells[l].aiSolution;l++)o++;for(l=e.length-1;l>=0&&0===e.cells[l].aiSolution;l--)i--;e.sections.forEach(t=>{let s=n.a.Utility.cloneArray(t.possibleStartIndexes);t.possibleStartIndexes.forEach(r=>{const a=e.cells[r+t.length];let c;for((r<o||r>i)&&(s=n.a.Utility.removeFromArray(s,r)),a&&1===a.aiSolution&&(s=n.a.Utility.removeFromArray(s,r)),c=(c=r+t.length-1)>e.length-1?e.length-1:c,l=r;l<=c;l++)(l>e.length-1||0===e.cells[l].aiSolution)&&(s=n.a.Utility.removeFromArray(s,r))}),o+=t.length+1,i+=t.length+1,t.possibleStartIndexes=s})}findKnownPositivesAndNegatives(e){const t=n.a.Utility.getZeroFilledArray(e.length);e.sections.forEach(l=>{const o=n.a.Utility.getZeroFilledArray(e.length);l.possibleStartIndexes.forEach(e=>{const n=e,i=n+l.length-1;let s;for(s=n;s<=i;s++)o[s]++,t[s]++}),o.forEach((t,o)=>{const n=e.cells[o];n&&null===n.aiSolution&&t===l.possibleStartIndexes.length&&this.setCellSolution(n,1)})}),t.forEach((t,l)=>{const o=e.cells[l];o&&null===o.aiSolution&&0===t&&this.setCellSolution(o,0)})}findAnchoredSections(e){let t,l,o,n;if(e.sections.length>0){for(o=e.sections[0],n=e.sections[e.sections.length-1],l=null,t=0;t<e.cells.length&&null!==e.cells[t].aiSolution;t++)if(1===e.cells[t].aiSolution){l=[t,t+o.length-1];break}if(null!==l){for(t=l[0];t<=l[1];t++)e.cells[t]&&this.setCellSolution(e.cells[t],1);e.cells[t]&&this.setCellSolution(e.cells[t],0)}for(l=null,t=e.cells.length-1;t>=0&&null!==e.cells[t].aiSolution;t--)if(1===e.cells[t].aiSolution){l=[t-n.length+1,t];break}if(null!==l){for(t=l[0];t<=l[1];t++)e.cells[t]&&this.setCellSolution(e.cells[t],1);e.cells[l[0]-1]&&this.setCellSolution(e.cells[l[0]-1],0)}}}findSectionDefiningChains(e){const t=this;let l,o,i,s=[],r=0;o=n.a.Utility.cloneArray(e.sections).sort(function(e,t){return e.length>t.length?-1:1}),i=o[0],e.cells.forEach((e,t)=>{1===e.aiSolution&&(1!==r?(l={start:t,length:1},s.push(l)):l.length++),r=e.aiSolution}),s.forEach(l=>{l.length===i.length&&(e.cells[l.start-1]&&t.setCellSolution(e.cells[l.start-1],0),e.cells[l.start+i.length]&&t.setCellSolution(e.cells[l.start+i.length],0),i.solved=!0)})}findCompletedSections(e){e.sections.forEach(t=>{let l,o;t.solved||1!==t.possibleStartIndexes.length||(l=t.possibleStartIndexes[0]-1,o=t.possibleStartIndexes[0]+t.length,e.cells[l]&&null===e.cells[l].aiSolution&&this.setCellSolution(e.cells[l],0),e.cells[o]&&null===e.cells[o].aiSolution&&this.setCellSolution(e.cells[o],0),t.solved=!0)})}findCompletedLines(e){let t=0,l=0;e.sections.forEach(e=>{t+=e.length}),e.cells.forEach(e=>{l+=1===e.aiSolution}),t===l&&e.cells.forEach(e=>{null===e.aiSolution&&this.setCellSolution(e,0)})}_reset(){const e=this,t=[],l=[];let o;for(e.isReset=!0,e.solutionLog=[],e.lines=[],this.log("Resetting variables","info"),e.puzzle.cells.forEach(e=>{e.aiSolution=null}),o=0;o<e.puzzle.width;o++)t.push(o);for(o=0;o<e.puzzle.height;o++)l.push(o);e.puzzle.rowHints.forEach((l,o)=>{let i=new n.a.PuzzleLine({type:"row",index:o,length:e.puzzle.width,cells:e.puzzle.getRowCells(o)});l.forEach((e,l)=>{i.sections.push({index:l,length:e,possibleStartIndexes:t,knownIndexes:[],solved:!1}),i.minimumSectionLength+=e+1}),i.minimumSectionLength--,e.lines.push(i)}),e.puzzle.columnHints.forEach((t,o)=>{const i=new n.a.PuzzleLine({type:"column",index:o,length:this.puzzle.height,cells:this.puzzle.getColumnCells(o)});t.forEach((e,t)=>{i.sections.push({index:t,length:e,possibleStartIndexes:l,knownIndexes:[],solved:!1}),i.minimumSectionLength+=e+1}),i.minimumSectionLength--,e.lines.push(i)})}setCellSolution(e,t){null===e.aiSolution&&this.lines.forEach(l=>{const o="row"===l.type&&l.index===e.row,n="column"===l.type&&l.index===e.column;let i=0;(o||n)&&(l.cells.forEach(l=>{l.index===e.index?(l.aiSolution=t,i++):null!==l.aiSolution&&i++}),i===l.length&&(l.solved=!0))})}log(e,t){this.solutionLog.push({html:e,cssClass:t})}getTotalSolved(){let e=0;return this.puzzle.cells.forEach(t=>{e+=null!==t.aiSolution}),e}getProgress(){let e=0,t=0;return this.lines.forEach(l=>{e+=l.sections.length*("row"===l.type?this.puzzle.width:this.puzzle.height),l.sections.forEach(e=>{t+=e.possibleStartIndexes.length})}),e-t}}},function(e,t,l){"use strict";l.r(t);var o=l(0),n=l.n(o);n.a.Gui=class{constructor(e){const t=document.querySelector("head"),l=document.createElement("link");this.theme=e||"default",this.themePath=this._resolveThemePath()+"/"+this.theme,this.themeStylesheetPath=this.themePath+"/styles.css",l.rel="stylesheet",l.type="text/css",l.href=this.themeStylesheetPath,t.appendChild(l),this.themeTemplatesPath=this.themePath+"/templates",this.templates=[new n.a.GuiTemplate("gameControls",this.themeTemplatesPath+"/controls-game.html"),new n.a.GuiTemplate("generateControls",this.themeTemplatesPath+"/controls-generate.html"),new n.a.GuiTemplate("console",this.themeTemplatesPath+"/console.html"),new n.a.GuiTemplate("previewGrid",this.themeTemplatesPath+"/preview-grid.html"),new n.a.GuiTemplate("puzzleGrid",this.themeTemplatesPath+"/puzzle-grid.html")],this.templates.forEach(e=>{e.load()})}draw(e){this.drawPuzzle(e),this.drawGameControls(),this.drawGenerateControls(),this.drawConsole()}drawPuzzle(e){const t=this,l=t._getTemplate("puzzleGrid");if(t.puzzle=e,t.gridContainer=document.querySelector("[data-nonogram-puzzle-grid]"),!t.gridContainer)return;const o=()=>{const e=t.gridContainer,o=l.getNode(),n=o.querySelector("[data-nonogram-puzzle-grid-table-thead-th]"),i=o.querySelector("[data-nonogram-puzzle-grid-table-row]"),s={tl:0,tr:t.puzzle.width-1,bl:t.puzzle.width*t.puzzle.height-t.puzzle.width,br:t.puzzle.width*t.puzzle.height-1};t.puzzle.columnHints.forEach((e,t)=>{const l=document.importNode(n.content,!0).querySelector("th"),o=l.querySelector(".fill");l.setAttribute("data-column",t.toString()),l.classList.add("hint","top"),e.forEach(e=>{let t=document.createElement("span");t.textContent=e,o.appendChild(t)}),n.parentNode.insertBefore(l,n)}),t.puzzle.grid.forEach((e,l)=>{const o=t.puzzle.getRowCells(l),n=document.importNode(i.content,!0).querySelector("tr"),r=n.querySelector("[data-nonogram-puzzle-grid-table-cell]"),a=n.querySelector("[data-row-hints] .fill");n.setAttribute("data-row",l.toString()),t.puzzle.rowHints[l].forEach(e=>{let t=document.createElement("span");t.textContent=e,a.appendChild(t)}),o.forEach(e=>{const t=document.importNode(r.content,!0).querySelector("td");t.setAttribute("data-index",e.index),t.setAttribute("data-column",e.column),t.setAttribute("data-row",e.row),t.classList.add("puzzle-cell","flippable"),Object.keys(s).forEach(l=>{e.index===s[l]&&t.classList.add(l)}),n.appendChild(t)}),i.parentNode.appendChild(n)}),e.innerHtml=e.textContent="",e.appendChild(o),t._makePuzzlePlayable(),t.drawPreview("userSolution")};l.isLoaded?o():l.loaded(o)}drawGameControls(){const e=this,t=e._getTemplate("gameControls"),l=()=>{const l=document.querySelector("[data-nonogram-game-controls]"),o=t.getNode();let n;l&&(l.innerHtml=l.textContent="",l.appendChild(o),(n=document.querySelector("#nonogram-puzzle-fill-mode")).addEventListener("change",()=>{const t=document.querySelector('[for="nonogram-puzzle-fill-mode"]'),l=t.querySelector(".active"),o=t.querySelector(".inactive");l.classList.remove("active"),l.classList.add("inactive"),o.classList.remove("inactive"),o.classList.add("active"),n.checked?(t.classList.add("on"),e.playerClickMode=0):(t.classList.remove("on"),e.playerClickMode=1)}),window.addEventListener("keyup",e=>{e.key&&"x"===e.key&&n.dispatchEvent(new MouseEvent("click"))}))};t.isLoaded?l():t.loaded(l)}drawGenerateControls(){const e=this,t=e._getTemplate("generateControls"),l=()=>{const l=document.querySelector("[data-nonogram-generate-controls]"),o=t.getNode(),i=o.querySelector("[data-nonogram-generate-width]"),s=o.querySelector("[data-nonogram-generate-height]"),r=o.querySelector("[data-nonogram-generate-width-options]"),a=o.querySelector("[data-nonogram-generate-height-options]");let c,u,d,h,p,g,m,f;if(l){for(c=5;c<=30;c++)u=document.importNode(r.content,!0),d=document.importNode(a.content,!0),(h=u.querySelector("option")).textContent=h.value=c,(p=d.querySelector("option")).textContent=p.value=c,e.puzzle.width===c&&h.setAttribute("selected","selected"),e.puzzle.height===c&&p.setAttribute("selected","selected"),i.appendChild(h),s.appendChild(p);l.innerHtml=l.textContent="",l.appendChild(o),g=document.querySelector("[data-nonogram-generate-button]"),m=document.querySelector("[data-nonogram-game-reset]"),f=document.querySelector("[data-nonogram-game-solve]"),g.addEventListener("click",()=>{const t=document.querySelector("[data-nonogram-generate-width]"),l=document.querySelector("[data-nonogram-generate-height]"),o=t.value,i=l.value,s=new n.a.Creator(o,i).createRandom();e.draw(s)}),m.addEventListener("click",()=>{e._resetPuzzle()}),f.addEventListener("click",()=>{e.drawSolution(),e.drawPreview("solution")})}};t.isLoaded?l():t.loaded(l)}drawConsole(){const e=this,t=e._getTemplate("console"),l=()=>{e.updateConsole()};t.isLoaded?l():t.loaded(l)}updateConsole(){const e=this,t=e._getTemplate("console"),l=document.querySelector("[data-nonogram-console]"),o=t.getNode(),i=o.querySelector("[data-nonogram-console-output]"),s=o.querySelector("[data-nonogram-console-line]");l&&(e.puzzle.creator instanceof n.a.Creator&&e.puzzle.creator.log.forEach(e=>{const t=document.importNode(s.content,!0).querySelector("code");t.textContent=e,i.appendChild(t)}),l.innerHtml=l.textContent="",l.appendChild(o))}drawPreview(e){const t=this,l=t._getTemplate("previewGrid"),o=()=>{const o=document.querySelector("[data-nonogram-preview-grid]"),n=l.getNode();o.innerHtml=o.textContent="",o.appendChild(n.querySelector("[data-nonogram-preview]"));const i=document.querySelector("[data-nonogram-preview-canvas]"),s=i.getContext("2d"),r=i.parentElement.parentElement.parentElement,a=r.offsetWidth,c=r.offsetHeight,u=a/c,d=t.puzzle.width/t.puzzle.height;let h;h=u>d?Math.floor(c/t.puzzle.height):Math.floor(a/t.puzzle.width),i.width=h*t.puzzle.width,i.height=h*t.puzzle.height,t.puzzle.cells.forEach(t=>{1===t[e]&&s.fillRect(t.column*h,t.row*h,h,h)})};l.isLoaded?o():l.loaded(o)}drawSolution(){const e=this;e.gridContainer.querySelectorAll("td.filled").forEach(e=>{e.classList.remove("filled","solution-positive","solution-negative","user-positive","user-negative","flipped")}),e.puzzle.cells.forEach(t=>{const l=e.gridContainer.querySelector('td[data-index="'+t.index+'"]');t.userSolution=t.solution,l.classList.add("user-solved"),1===t.solution?l.classList.add("solution-positive","user-positive","flipped"):l.classList.add("solution-negative","user-negative")})}_makePuzzlePlayable(){const e=this,t=e.gridContainer.querySelector(".nonogram-puzzle-grid"),l=e.gridContainer.querySelectorAll(".nonogram-puzzle-grid td.puzzle-cell"),o=e.gridContainer.querySelectorAll(".nonogram-puzzle-grid td");e.playerClickMode=1,l.forEach(l=>{l.classList.add("playable"),l.addEventListener("mouseenter",e=>{const t=e.currentTarget,l=t.getAttribute("data-row"),n=t.getAttribute("data-column");o.forEach(e=>{e.getAttribute("data-row")===l||e.getAttribute("data-column")===n?e.classList.add("row-column-highlight"):e.classList.remove("row-column-highlight")})}),l.addEventListener("click",l=>{const o=l.currentTarget,n=o.getAttribute("data-index"),i=e.puzzle.getCellByIndex(n);l.preventDefault(),i.userSolution=i.userSolution===e.playerClickMode?null:e.playerClickMode,t.classList.remove("solved"),o.classList.remove("user-solved","user-positive","user-negative","solution-positive","solution-negative"),1===i.userSolution?o.classList.add("user-solved","user-positive"):0===i.userSolution&&o.classList.add("user-solved","user-negative"),o.classList.toggle("flipped"),e.drawPreview("userSolution"),e.puzzle.checkUserSolution()&&e._showPuzzleSolved()})}),t.addEventListener("mouseleave",()=>{o.forEach(e=>{e.classList.remove("row-column-highlight")})})}_resetPuzzle(){const e=this.gridContainer.querySelectorAll(".nonogram-puzzle-grid td.puzzle-cell");this.gridContainer.classList.remove("solved"),this.puzzle.cells.forEach(e=>{e.userSolution=null}),e.forEach(e=>{e.classList.remove("user-solved","user-positive","user-negative","solution-positive","solution-negative")}),this.gridContainer.querySelector("[data-nonogram-preview-grid]").innerHTML="",this.drawPreview("userSolution")}_showPuzzleSolved(){this.gridContainer.querySelector(".nonogram-puzzle-grid").classList.add("solved")}_getTemplate(e){const t=this.templates.find(t=>t.name===e);if(!t)throw'"'+e+'" template not found.';return t}_resolveThemePath(){let e="";return document.querySelectorAll("script").forEach(t=>{try{const l=new URL(t.src),o=l.pathname.split("/").pop();"nonogram.min.js"===o&&(e=l.href.replace(o,"")+"themes")}catch(e){}}),e}}},function(e,t,l){"use strict";l.r(t);var o=l(0);l.n(o).a.GuiTemplate=class{constructor(e,t){this.name=e,this.path=t,this.html="",this.onLoadedCallbacks=[],this.isLoaded=!1}loaded(e){this.onLoadedCallbacks.push(e)}fireOnLoaded(){this.onLoadedCallbacks.forEach(e=>{e()})}load(){const e=this;fetch(e.path).then(t=>{t.ok?t.text().then(t=>{e.html=t,e.isLoaded=!0,e.fireOnLoaded()}):console.log('loading failed for "'+e.path+'"')})}getNode(){const e=document.createElement("div");return e.innerHTML=this.html,e}}},function(e,t,l){"use strict";l.r(t);var o=l(0),n=l.n(o);t.default=n.a}]).default});