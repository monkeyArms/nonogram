!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Nonogram",[],t):"object"==typeof exports?exports.Nonogram=t():e.Nonogram=t()}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var l=t[o]={i:o,l:!1,exports:{}};return e[o].call(l.exports,l,l.exports,n),l.l=!0,l.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)n.d(o,l,function(t){return e[t]}.bind(null,l));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="dist/",n(n.s=0)}([function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n.r(t);var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,l;return t=e,l=[{key:"removeFromArray",value:function(e,t){var n=e.indexOf(t);return-1!==n&&e.splice(n,1),e}},{key:"getZeroFilledArray",value:function(e){return new Array(e).fill(0)}},{key:"cloneArray",value:function(e){return e.slice(0)}},{key:"getRandomIntBetween",value:function(e,t){var n=Math.ceil(e),o=Math.floor(t);return Math.floor(Math.random()*(o-n+1))+n}}],(n=null)&&o(t.prototype,n),l&&o(t,l),e}();function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===t||void 0===n)throw"width and height are required constructor parameters.";if(t<=0||n<=0||1===t&&1===n)throw"invalid dimensions: "+t.toString()+" x "+n.toString();this.width="number"==typeof t?t:parseInt(t.toString(),10),this.height="number"==typeof n?n:parseInt(n.toString(),10),this.totalCells=this.width*this.height,this.reset()}var t,n,o;return t=e,(n=[{key:"reset",value:function(){var e=this,t=l.getZeroFilledArray;this.creator=null,this.cells=[],this.rowHints=[],this.columnHints=[],this.grid=t(this.height).map(function(){return t(e.width)})}},{key:"checkUserSolution",value:function(){return this.cells.every(function(e){var t=1===e.userSolution?1:0;return e.solution===t})}},{key:"getRowCells",value:function(e){var t,n=[],o=e*this.width,l=o+this.width;for(t=o;t<l;t++)n.push(this.cells[t]);return n.length>0&&n}},{key:"getColumnCells",value:function(e){var t,n=[];for(t=e;t<this.cells.length;t+=this.width)n.push(this.cells[t]);return n.length>0&&n}},{key:"getCellByIndex",value:function(e){var t="number"!=typeof e?parseInt(e,10):e;return!!this.cells[t]&&this.cells[t]}}])&&i(t.prototype,n),o&&i(t,o),e}();var s=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.index=-1,this.column=-1,this.row=-1,this.solution=null,this.userSolution=null,this.aiSolution=null,Object.assign(this,t)};var a=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="",this.index=-1,this.length=0,this.minimumSectionLength=0,this.sections=[],this.cells=[],this.solved=!1,Object.assign(this,t)};function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.puzzle=t,this._reset()}var t,n,o;return t=e,(n=[{key:"solve",value:function(){var e,t,n,o,l,i,r=(new Date).getTime(),s=-1,a=1;for(this.isReset||this._reset(),this.isReset=!1,this._log("Starting solve algorithm","info");this._getProgress()>s&&this._getTotalSolved()<this.puzzle.cells.length;){for(t=(new Date).getTime(),s=this._getProgress(),l=0;l<this.lines.length;l++)(i=this.lines[l]).solved||this.eliminateImpossibleFits(i),i.solved||this.findKnownPositivesAndNegatives(i),i.solved||this.findSectionDefiningChains(i),i.solved||this.findAnchoredSections(i),i.solved||this.findCompletedSections(i),i.solved||this.findCompletedLines(i);n=((new Date).getTime()-t)/1e3,this._log("Pass "+a+" completed in "+n+" seconds :: "+this._getTotalSolved()+"/"+this.puzzle.cells.length+" cells solved","info"),a++}return e=this._getTotalSolved()===this.puzzle.cells.length,o=((new Date).getTime()-r)/1e3,this._log("Solve algorithm finished in "+o+" seconds.","info"),e?this._log("Solution Found.","success"):this._log("Could not find solution.","failure"),this.elapsedTime=o,e}},{key:"eliminateImpossibleFits",value:function(e){var t,n,o,i,r,s,a,u,c,h,d=0,g=e.length-e.minimumSectionLength;if(0===e.sections.length)for(c=0;c<e.cells.length;c++)this._setCellSolution(e.cells[c],0);for(h=0;h<e.length&&0===e.cells[h].aiSolution;h++)d++;for(h=e.length-1;h>=0&&0===e.cells[h].aiSolution;h--)g--;for(r=0;r<e.sections.length;r++){for(n=e.sections[r],i=l.cloneArray(n.possibleStartIndexes),s=0;s<n.possibleStartIndexes.length;s++)for(o=n.possibleStartIndexes[s],a=e.cells[o+n.length],(o<d||o>g)&&(i=l.removeFromArray(i,o)),a&&1===a.aiSolution&&(i=l.removeFromArray(i,o)),u=(u=o+n.length-1)>e.length-1?e.length-1:u,t=o;t<=u;t++)(t>e.length-1||0===e.cells[t].aiSolution)&&(i=l.removeFromArray(i,o));d+=n.length+1,g+=n.length+1,n.possibleStartIndexes=i}}},{key:"findKnownPositivesAndNegatives",value:function(e){var t,n,o,i,r,s,a,u,c,h,d=l.getZeroFilledArray(e.length);for(t=0;t<e.sections.length;t++){for(n=e.sections[t],o=l.getZeroFilledArray(e.length),i=0;i<n.possibleStartIndexes.length;i++)for(s=(r=n.possibleStartIndexes[i])+n.length-1,a=r;a<=s;a++)o[a]++,d[a]++;for(u=0;u<o.length;u++)c=o[u],(h=e.cells[u])&&null===h.aiSolution&&c===n.possibleStartIndexes.length&&this._setCellSolution(h,1)}for(u=0;u<d.length;u++)c=d[u],(h=e.cells[u])&&null===h.aiSolution&&0===c&&this._setCellSolution(h,0)}},{key:"findAnchoredSections",value:function(e){var t,n,o,l;if(e.sections.length>0){for(o=e.sections[0],l=e.sections[e.sections.length-1],n=null,t=0;t<e.cells.length&&null!==e.cells[t].aiSolution;t++)if(1===e.cells[t].aiSolution){n=[t,t+o.length-1];break}if(null!==n){for(t=n[0];t<=n[1];t++)e.cells[t]&&this._setCellSolution(e.cells[t],1);e.cells[t]&&this._setCellSolution(e.cells[t],0)}for(n=null,t=e.cells.length-1;t>=0&&null!==e.cells[t].aiSolution;t--)if(1===e.cells[t].aiSolution){n=[t-l.length+1,t];break}if(null!==n){for(t=n[0];t<=n[1];t++)e.cells[t]&&this._setCellSolution(e.cells[t],1);e.cells[n[0]-1]&&this._setCellSolution(e.cells[n[0]-1],0)}}}},{key:"findSectionDefiningChains",value:function(e){var t,n,o,i,r,s=[],a=0;for(r=l.cloneArray(e.sections).sort(function(e,t){return e.length>t.length?-1:1})[0],t=0;t<e.cells.length;t++)1===(n=e.cells[t]).aiSolution&&(1!==a?(o={start:t,length:1},s.push(o)):o&&o.length++),a=n.aiSolution;for(i=0;i<s.length;i++)(o=s[i]).length===r.length&&(e.cells[o.start-1]&&this._setCellSolution(e.cells[o.start-1],0),e.cells[o.start+r.length]&&this._setCellSolution(e.cells[o.start+r.length],0),r.solved=!0)}},{key:"findCompletedSections",value:function(e){var t,n,o,l;for(t=0;t<e.sections.length;t++)(n=e.sections[t]).solved||1!==n.possibleStartIndexes.length||(o=n.possibleStartIndexes[0]-1,l=n.possibleStartIndexes[0]+n.length,e.cells[o]&&null===e.cells[o].aiSolution&&this._setCellSolution(e.cells[o],0),e.cells[l]&&null===e.cells[l].aiSolution&&this._setCellSolution(e.cells[l],0),n.solved=!0)}},{key:"findCompletedLines",value:function(e){var t,n,o,l=0,i=0;for(t=0;t<e.sections.length;t++)l+=e.sections[t].length;for(n=0;n<e.cells.length;n++)i+=1===(o=e.cells[n]).aiSolution;if(l===i)for(n=0;n<e.cells.length;n++)null===(o=e.cells[n]).aiSolution&&this._setCellSolution(o,0)}},{key:"_reset",value:function(){var e,t,n,o,l,i,r,s,u,c,h=[],d=[];for(this.isReset=!0,this.elapsedTime=0,this.solutionLog=[],this.lines=[],this._log("Resetting variables","info"),t=0;t<this.puzzle.cells.length;t++)this.puzzle.cells[t].aiSolution=null;for(e=0;e<this.puzzle.width;e++)h.push(e);for(e=0;e<this.puzzle.height;e++)d.push(e);for(n=0;n<this.puzzle.rowHints.length;n++)if(o=this.puzzle.rowHints[n],l=this.puzzle.getRowCells(n)){for(i=new a({type:"row",index:n,length:this.puzzle.width,cells:l}),r=0;r<o.length;r++)s=o[r],i.sections.push({index:r,length:s,possibleStartIndexes:h,knownIndexes:[],solved:!1}),i.minimumSectionLength+=s+1;i.minimumSectionLength--,this.lines.push(i)}for(u=0;u<this.puzzle.columnHints.length;u++){for(c=this.puzzle.columnHints[u],i=new a({type:"column",index:u,length:this.puzzle.height,cells:this.puzzle.getColumnCells(u)}),r=0;r<c.length;r++)s=c[r],i.sections.push({index:r,length:s,possibleStartIndexes:d,knownIndexes:[],solved:!1}),i.minimumSectionLength+=s+1;i.minimumSectionLength--,this.lines.push(i)}}},{key:"_setCellSolution",value:function(e,t){var n,o,l,i,r,s,a;if(null===e.aiSolution)for(n=0;n<this.lines.length;n++)if(l="row"===(o=this.lines[n]).type&&o.index===e.row,i="column"===o.type&&o.index===e.column,r=0,l||i){for(s=0;s<o.cells.length;s++)(a=o.cells[s]).index===e.index?(a.aiSolution=t,r++):null!==a.aiSolution&&r++;r===o.length&&(o.solved=!0)}}},{key:"_log",value:function(e,t){this.solutionLog.push({html:e,cssClass:t||"info"})}},{key:"_getTotalSolved",value:function(){var e,t=0;for(e=0;e<this.puzzle.cells.length;e++)t+=null!==this.puzzle.cells[e].aiSolution;return t}},{key:"_getProgress",value:function(){var e,t,n,o=0,l=0;for(e=0;e<this.lines.length;e++)for(o+=(t=this.lines[e]).sections.length*("row"===t.type?this.puzzle.width:this.puzzle.height),n=0;n<t.sections.length;n++)l+=t.sections[n].possibleStartIndexes.length;return o-l}}])&&u(t.prototype,n),o&&u(t,o),e}();function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,o=[{key:"_populatePuzzleFromGrid",value:function(e,t){var n,o,l,i,r,a,u,c,h,d,g;for(e.reset(),e.grid=t,o=0;o<e.grid.length;o++){for(l=e.grid[o],h=[],e.rowHints[o]=[],i=0;i<l.length;i++)u=r=l[i],c=i>0?e.grid[o][i-1]:0,e.cells.push(new s({index:o*e.width+i,column:i,row:o,solution:r})),1===u&&0===c?h.push(1):0===u&&1===c?h.push(0):1===u&&1===c&&h[h.length-1]++;for(d=0;d<h.length;d++)(g=h[d])>0&&e.rowHints[o].push(g)}for(i=0;i<e.width;i++){for(e.columnHints[i]=[],n=[],a=i;a<e.totalCells;a+=e.width)l=Math.floor(a/e.width),u=e.grid[l][i],c=l>0?e.grid[l-1][i]:0,1===u&&0===c?n.push(1):0===u&&1===c?n.push(0):1===u&&1===c&&n[n.length-1]++;for(d=0;d<n.length;d++)(g=n[d])>0&&e.columnHints[i].push(g)}return e}}],(n=[{key:"createRandom",value:function(t,n,o){var i,s,a,u,h,d,g,f,p=(new Date).getTime(),m=!1,v="number"==typeof o&&o>=0&&o<=1;for(this.puzzle=new r(t,n),this._reset();!1===m;){for(s=v?o:l.getRandomIntBetween(200,800)/1e3,a=[],u=[],i=0,this._log("Creating random "+this.puzzle.width+"x"+this.puzzle.height+" puzzle with density of "+s+"..."),g=0;g<this.puzzle.totalCells;g++)i+=h=Math.random()<s?1:0,g%this.puzzle.width==0&&g>0&&(a.push(u),u=[]),u.push(h);0!==i?i!==this.puzzle.totalCells?(a.push(u),this.puzzle=e._populatePuzzleFromGrid(this.puzzle,a),(d=new c(this.puzzle)).solve()?(m=!0,f=((new Date).getTime()-p)/1e3,this._log("Puzzle is solvable - solved in "+d.elapsedTime+" seconds"),this._logLine(),this._log("Puzzle generated in "+f+" seconds."),this.creationTime=f,this.solvingTime=d.elapsedTime):this._log("Puzzle cannot be solved.  Trying again..."),this._logLine()):this._log("Generated puzzle has all cells filled.  Trying again..."):this._log("Generated puzzle has no cells filled.  Trying again...")}return this.puzzle.creator=this,this.puzzle}},{key:"createFromGrid",value:function(t){var n,o,l=new Date,i=0,s=0;if(this._reset(),this._log("creating puzzle from grid array."),!(t instanceof Array))throw"grid is not an array";return t.forEach(function(e,t){if(!(e instanceof Array))throw"grid is not a multi-dimensional array";if(0===i)i=e.length;else if(e.length!==i)throw"row "+t+" has an invalid length ("+e.length+") - expecting "+i;s++}),this._log("grid is valid"),this._log("populating "+i+"x"+s+" puzzle"),n=new r(i,s),this.puzzle=e._populatePuzzleFromGrid(n,t),this.puzzle.creator=this,new c(this.puzzle).solve()?(this._log("Puzzle is solvable."),this._logLine(),o=((new Date).getTime()-l)/1e3,this._log("Puzzle built and solved in "+o+" seconds."),this._logLine(),this.puzzle):(this._log("Puzzle cannot be solved."),this._logLine(),!1)}},{key:"createFromHints",value:function(e){var t,n,o,l,i,a=this,u=new Date;if(this._reset(),this._log("creating puzzle from hints"),"object"!==h(e)||!e.row||!e.column)throw'parameter passed to createFromHints() must be an object containing "row" and "column" properties';if(!(e.row instanceof Array&&e.column instanceof Array))throw"hints.row or hints.column must be an array.";return this._log("found row and column hints"),t=e.column.length,n=e.row.length,(o=new r(t,n)).rowHints=e.row,o.columnHints=e.column,o.creator=this,this._log("populating "+t+"x"+n+" puzzle"),o.grid.forEach(function(e,t){e.forEach(function(e,n){o.cells.push(new s({index:t*o.width+n,column:n,row:t}))})}),this.puzzle=o,(l=new c(this.puzzle)).solve()?(this._log("Puzzle is solvable."),this._logLine(),l.puzzle.cells.forEach(function(e,t){var n=a.puzzle.getCellByIndex(t);n.aiSolution=e.aiSolution,n.solution=e.aiSolution}),i=((new Date).getTime()-u)/1e3,this._log("Puzzle built and solved in "+i+" seconds."),this._logLine(),this.puzzle):(this._log("Puzzle cannot be solved."),this._logLine(),!1)}},{key:"_log",value:function(e){this.log.push(e)}},{key:"_logLine",value:function(){this.log.push("-----------------------------------")}},{key:"_reset",value:function(){this.log=[],this.creationTime=0,this.solvingTime=0}}])&&d(t.prototype,n),o&&d(t,o),e}();function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var p=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.path=n,this.html="",this.onLoadedCallbacks=[],this.isLoaded=!1,this.loadedPromise=null}var t,n,o;return t=e,(n=[{key:"onLoad",value:function(e){this.onLoadedCallbacks.push(e)}},{key:"fireOnLoaded",value:function(){this.onLoadedCallbacks.forEach(function(e){e()})}},{key:"load",value:function(){var e=this;return this.loadedPromise=new Promise(function(t){fetch(e.path).then(function(n){if(!n.ok)throw'loading failed for "'+e.path+'"';n.text().then(function(n){e.html=n,e.isLoaded=!0,e.fireOnLoaded(),t(e.name+" loaded and parsed")})})}),this.loadedPromise}},{key:"getNode",value:function(){var e=document.createElement("div");return e.innerHTML=this.html,e}}])&&f(t.prototype,n),o&&f(t,o),e}(),m={"Small Example 1":{width:8,height:8,solutionGrid:[[0,0,0,0,1,1,1,0],[0,0,0,1,1,1,1,1],[0,0,0,1,1,1,1,1],[1,1,0,0,1,1,1,0],[0,1,0,1,1,1,1,1],[1,1,0,1,0,0,0,1],[1,1,0,1,1,1,1,1],[1,0,0,0,1,1,1,0]]},"Small Example 2":{width:8,height:8,hints:{row:[[3],[5],[5],[2,3],[1,5],[2,1,1],[2,5],[1,3]],column:[[1,3],[4],[],[2,3],[5,2],[5,2],[5,2],[2,3]]}},"Small Example 3":{width:10,height:10,hints:{column:[[3],[1,1],[1],[6],[8],[2,1],[4,1],[10],[3,1],[3]],row:[[4],[5],[2,3],[2,3],[2,1],[2,1],[2,1],[10],[1,1,1],[2,1,1]]}},"Medium Example 1":{width:16,height:18,hints:{column:[[5],[4,3,3],[7,6,2],[4,3,4,1],[3,2,4,1,2],[2,6,4],[3,3,1,1],[4,6,4],[6,4,1,1],[4,3,4,1],[7,6,2],[4,3,3],[5],[3],[5,3,3],[2,4,1,2]],row:[[5],[9],[3,5],[3,5,1],[4,4,2],[2,1,1,2,1],[2,2,1],[2,3,2,1],[7,2],[9,1],[2,2,2,2,2],[3,2,2,3,2],[4,1,1,6],[1,2,2,2],[16],[2,1,1,1,1,2,1],[2,2,2,2,2],[9,1]]}},"Medium Example 2":{width:15,height:15,hints:{column:[[4],[3,1],[2,3],[1,2,2],[1,2,1],[1,1,1,1],[4,3,3],[2,2,4,3],[1,2,5,1],[1,2,4,1],[1,2,5,1],[2,2,4,3],[9,3],[5,1,1],[6,1]],row:[[4,5],[3,2,2],[2,1,1],[1,4,3],[2,9],[2,8],[2,3],[12],[1,7,1],[9],[5],[1,1],[2,2],[3,3],[1,7,1]]}},"Large Example 1":{width:30,height:30,hints:{column:[[19,9],[13,1,2,1,5],[11,4,1,1,2,3],[10,6,1,4,1,1],[9,7,1,1,3,2],[3,4,11,1,6],[2,1,2,3,3,3,7],[2,2,1,2,4,3,8],[3,2,2,1,2,6,7],[1,3,3,4,1,4,4,1],[5,4,2,5,2,2],[1,3,11,1,2,4],[3,2,14,5],[2,2,1,14,7],[1,2,2,2,10,2],[2,1,3,2,6,3,3],[5,6,6,2,2,4],[6,4,4,3,3,3],[6,3,2,1,1,3,5,2],[6,1,2,2,2,2,2,3],[7,1,9,2,4],[7,3,1,2,2,3],[8,2,5,4,3],[6,1,7,11],[5,1,3,2,12],[5,2,2,2,3,11],[4,5,4,3,10],[3,14,10],[3,3,5,2,9],[4,3,3,10]],row:[[10,19],[9,1,2,15],[6,1,1,1,14],[5,2,3,2,11,1],[6,7,11,1],[7,5,7,3],[8,4,3,4],[6,4,5,1,4,1],[5,8,6,2,1],[4,10,3,3,3,1],[3,3,5,2,4,2,2],[2,3,3,3,2,4,2,3],[2,3,1,1,5,2,1,6],[1,4,3,4,2,2,2,4],[1,4,3,4,5,3,3],[1,5,5,2,1,4,1,1],[1,15,3,2,3,1],[2,4,7,2,2,3,1],[1,4,4,7,2,1,3],[1,2,3,4,3,3,1],[1,1,3,5,2,6,1],[1,1,1,4,4,9],[2,3,1,1,1,9],[1,2,4,1,1,6,8],[1,10,1,7,7],[2,8,2,1,2,1,7],[3,6,3,1,1,1,7],[4,4,4,3,11],[3,5,20],[2,7,19]]}}};function v(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var z=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=document.querySelector("head"),l=document.createElement("link");this.boardSizes=[{name:"Tiny",handle:"tiny",size:1},{name:"Small",handle:"small",size:2},{name:"Medium",handle:"medium",size:3},{name:"Large",handle:"large",size:4}],this.boardSize=this.boardSizes[2],this.themePath=t||"./themes/default",this.themeStylesheetPath=this.themePath+"/styles.css",l.rel="stylesheet",l.type="text/css",l.href=this.themeStylesheetPath,o.prepend(l),this.templatesLoaded=[],this.themeTemplatesPath=this.themePath+"/templates",this.templates=[new p("gameControls",this.themeTemplatesPath+"/controls-game.html"),new p("generateControls",this.themeTemplatesPath+"/controls-generate.html"),new p("console",this.themeTemplatesPath+"/console.html"),new p("previewGrid",this.themeTemplatesPath+"/preview-grid.html"),new p("puzzleGrid",this.themeTemplatesPath+"/puzzle-grid.html")],this.templates.forEach(function(e){n.templatesLoaded.push(e.load())})}var t,n,o;return t=e,o=[{key:"_keypressCallback",value:function(e){e.key&&"x"===e.key&&document.querySelector("#nonogram-puzzle-fill-mode").dispatchEvent(new MouseEvent("click"))}}],(n=[{key:"draw",value:function(e){var t=this;this.puzzle=e,Promise.all(this.templatesLoaded).then(function(){t.drawGenerateControls(),t.drawPuzzle(e),t.drawGameControls(),t.drawConsole()})}},{key:"drawPuzzle",value:function(e){var t=this;Promise.all(this.templatesLoaded).then(function(){var n=t._getTemplate("puzzleGrid");if(t.puzzle=e,t.gridContainer=document.querySelector("[data-nonogram-puzzle-grid]"),t.gridContainer){var o=t.gridContainer,l=n.getNode(),i=l.querySelector("[data-nonogram-puzzle-grid-table-thead-th]"),r=l.querySelector("[data-nonogram-puzzle-grid-table-row]"),s={tl:0,tr:t.puzzle.width-1,bl:t.puzzle.width*t.puzzle.height-t.puzzle.width,br:t.puzzle.width*t.puzzle.height-1};t.puzzle.columnHints.forEach(function(e,t){var n=document.importNode(i.content,!0).querySelector("th"),o=n.querySelector(".fill");n.setAttribute("data-column",t.toString()),n.classList.add("hint","top"),e.forEach(function(e){var t=document.createElement("span");t.textContent=e,o.appendChild(t)}),i.parentNode.insertBefore(n,i)}),t.puzzle.grid.forEach(function(e,n){var o=t.puzzle.getRowCells(n),l=document.importNode(r.content,!0).querySelector("tr"),i=l.querySelector("[data-nonogram-puzzle-grid-table-cell]"),a=l.querySelector("[data-row-hints] .fill");l.setAttribute("data-row",n.toString()),t.puzzle.rowHints[n].forEach(function(e){var t=document.createElement("span");t.textContent=e,a.appendChild(t)}),o.forEach(function(e){var t=document.importNode(i.content,!0).querySelector("td");t.setAttribute("data-index",e.index),t.setAttribute("data-column",e.column),t.setAttribute("data-row",e.row),t.classList.add("puzzle-cell","flippable"),Object.keys(s).forEach(function(n){e.index===s[n]&&t.classList.add(n)}),l.appendChild(t)}),r.parentNode.appendChild(l)}),o.innerHtml=o.textContent="",o.appendChild(l),document.querySelector("[data-nonogram-puzzle-grid-table]").classList.add(t.boardSize.handle),t._resizeBoardForAvailableScreen(),t._makePuzzlePlayable(),t.drawPreview("userSolution")}})}},{key:"drawGameControls",value:function(){var t=this;Promise.all(this.templatesLoaded).then(function(){var n,o=t._getTemplate("gameControls"),l=document.querySelector("[data-nonogram-game-controls]"),i=o.getNode();l&&(l.innerHtml=l.textContent="",l.appendChild(i),(n=document.querySelector("#nonogram-puzzle-fill-mode")).addEventListener("change",function(){var e=document.querySelector('[for="nonogram-puzzle-fill-mode"]'),o=e.querySelector(".active"),l=e.querySelector(".inactive");o.classList.remove("active"),o.classList.add("inactive"),l.classList.remove("inactive"),l.classList.add("active"),n.checked?(e.classList.add("on"),t.playerClickMode=0):(e.classList.remove("on"),t.playerClickMode=1)}),window.removeEventListener("keyup",e._keypressCallback),window.addEventListener("keyup",e._keypressCallback))})}},{key:"drawGenerateControls",value:function(){var e=this;Promise.all(this.templatesLoaded).then(function(){var t,n,o,l,i,r,s,a,u,c,h,d,f,p,v=e._getTemplate("generateControls"),z=document.querySelector("[data-nonogram-generate-controls]"),y=v.getNode(),S=y.querySelector("[data-nonogram-generate-width]"),w=y.querySelector("[data-nonogram-generate-height]"),b=y.querySelector("[data-nonogram-generate-width-options]"),C=y.querySelector("[data-nonogram-generate-height-options]"),_=y.querySelector("[data-nonogram-choose-predefined]"),k=y.querySelector("[data-nonogram-board-size]"),L=y.querySelector("[data-nonogram-board-size-options]");if(z){for(t=5;t<=30;t++)n=document.importNode(b.content,!0),o=document.importNode(C.content,!0),(l=n.querySelector("option")).textContent=l.value=t,(i=o.querySelector("option")).textContent=i.value=t,e.puzzle.width===t&&l.setAttribute("selected","selected"),e.puzzle.height===t&&i.setAttribute("selected","selected"),S.appendChild(l),w.appendChild(i);Object.keys(m).forEach(function(t){r=document.importNode(b.content,!0),(s=r.querySelector("option")).textContent=s.value=t,t===e.selectedExample&&s.setAttribute("selected","selected"),_.appendChild(s)}),e.boardSizes.forEach(function(t){c=document.importNode(L.content,!0),(h=c.querySelector("option")).value=t.handle,h.textContent=t.name,t.handle===e.boardSize.handle&&h.setAttribute("selected","selected"),k.appendChild(h)}),z.innerHtml=z.textContent="",z.appendChild(y),p=document.querySelector("[data-nonogram-generate-button]"),a=document.querySelector("[data-nonogram-choose-predefined]"),u=document.querySelector("[data-nonogram-board-size]"),d=document.querySelector("[data-nonogram-game-reset]"),f=document.querySelector("[data-nonogram-game-solve]"),p.addEventListener("click",function(){var t=document.querySelector("[data-nonogram-generate-width]"),n=document.querySelector("[data-nonogram-generate-height]"),o=t.value,l=n.value,i=(new g).createRandom(o,l,null);e.selectedExample=null,e.draw(i),e._resizeBoardForAvailableScreen()}),a.addEventListener("change",function(){var t,n,o=new g;""!==a.value&&(Object.keys(m).forEach(function(l){a.value===l&&(t=m[l],e.selectedExample=l,t.solutionGrid?n=o.createFromGrid(t.solutionGrid):t.hints&&(n=o.createFromHints(t.hints)))}),n&&(e.draw(n),e._resizeBoardForAvailableScreen()))}),u.addEventListener("change",function(){e.boardSizes.forEach(function(t){t.handle===u.value&&e._changeBoardSize(t)})}),d.addEventListener("click",function(){e._resetPuzzle()}),f.addEventListener("click",function(){e.drawSolution(),e.drawPreview("solution"),e._showPuzzleSolved()})}})}},{key:"drawConsole",value:function(){var e=this;Promise.all(this.templatesLoaded).then(function(){var t=e._getTemplate("console"),n=document.querySelector("[data-nonogram-console]"),o=t.getNode(),l=o.querySelector("[data-nonogram-console-output]"),i=o.querySelector("[data-nonogram-console-line]");n&&(e.puzzle.creator instanceof g&&e.puzzle.creator.log.forEach(function(e){var t=document.importNode(i.content,!0).querySelector("code");t.textContent=e.toString(),l.appendChild(t)}),n.innerHtml=n.textContent="",n.appendChild(o))})}},{key:"drawPreview",value:function(e){var t=this;Promise.all(this.templatesLoaded).then(function(){var n=t._getTemplate("previewGrid"),o=document.querySelector("[data-nonogram-preview-grid]"),l=n.getNode();o.innerHtml=o.textContent="",o.appendChild(l.querySelector("[data-nonogram-preview]"));var i,r=document.querySelector("[data-nonogram-preview-canvas]"),s=r.getContext("2d"),a=r.parentElement.parentElement.parentElement,u=a.offsetWidth,c=a.offsetHeight,h=u/c,d=t.puzzle.width/t.puzzle.height;i=h>d?Math.floor(c/t.puzzle.height):Math.floor(u/t.puzzle.width),r.width=i*t.puzzle.width,r.height=i*t.puzzle.height,t.puzzle.cells.forEach(function(t){1===t[e]&&s.fillRect(t.column*i,t.row*i,i,i)})})}},{key:"drawSolution",value:function(){var e=this;Promise.all(this.templatesLoaded).then(function(){e.gridContainer.querySelectorAll("td.filled").forEach(function(e){e.classList.remove("filled","solution-positive","solution-negative","user-positive","user-negative","flipped")}),e.puzzle.cells.forEach(function(t){var n=e.gridContainer.querySelector('td[data-index="'+t.index+'"]');t.userSolution=t.solution,n.classList.add("user-solved"),1===t.solution?n.classList.add("solution-positive","user-positive","flipped"):n.classList.add("solution-negative","user-negative")})})}},{key:"_changeBoardSize",value:function(e){var t=document.querySelector("[data-nonogram-puzzle-grid-table]"),n=document.querySelector("[data-nonogram-board-size]");t&&n&&(t.classList.remove("tiny","small","medium","large"),t.classList.add(e.handle),n.value=e.handle,this.boardSize=e,this.drawPreview())}},{key:"_resizeBoardForAvailableScreen",value:function(){var e,t=this.gridContainer.querySelector(".nonogram-puzzle-grid"),n=this.gridContainer.clientWidth,o=this.boardSizes.sort(function(e,t){return e.size>t.size?-1:1});if(t.clientWidth>n)for(e=0;e<o.length&&(o[e].size<this.boardSize.size&&this._changeBoardSize(o[e]),!(t.clientWidth<=n));e++);this.drawConsole()}},{key:"_makePuzzlePlayable",value:function(){var e=this,t=this.gridContainer.querySelector(".nonogram-puzzle-grid"),n=this.gridContainer.querySelectorAll(".nonogram-puzzle-grid td.puzzle-cell"),o=this.gridContainer.querySelectorAll(".nonogram-puzzle-grid td");this.playerClickMode=1,n.forEach(function(n){n.classList.add("playable"),n.addEventListener("mouseenter",function(e){var t=e.currentTarget,n=t.getAttribute("data-row"),l=t.getAttribute("data-column");o.forEach(function(e){e.getAttribute("data-row")===n||e.getAttribute("data-column")===l?e.classList.add("row-column-highlight"):e.classList.remove("row-column-highlight")})}),n.addEventListener("click",function(n){var o=n.currentTarget,l=o.getAttribute("data-index"),i=e.puzzle.getCellByIndex(l),r=document.querySelector("[data-nonogram-puzzle-grid-solved]");n.preventDefault(),i.userSolution=i.userSolution===e.playerClickMode?null:e.playerClickMode,t.classList.remove("solved"),o.classList.remove("user-solved","user-positive","user-negative","solution-positive","solution-negative"),1===i.userSolution?o.classList.add("user-solved","user-positive"):0===i.userSolution&&o.classList.add("user-solved","user-negative"),o.classList.toggle("flipped"),e.drawPreview("userSolution"),e.puzzle.checkUserSolution()?e._showPuzzleSolved():r.textContent=""})}),t.addEventListener("mouseleave",function(){o.forEach(function(e){e.classList.remove("row-column-highlight")})})}},{key:"_resetPuzzle",value:function(){var e=this.gridContainer.querySelectorAll(".nonogram-puzzle-grid td.puzzle-cell"),t=this.gridContainer.querySelector(".nonogram-puzzle-grid"),n=document.querySelector("[data-nonogram-puzzle-grid-solved]");t.classList.remove("solved"),n.textContent="",this.puzzle.cells.forEach(function(e){e.userSolution=null}),e.forEach(function(e){e.classList.remove("user-solved","user-positive","user-negative","solution-positive","solution-negative")}),this.gridContainer.querySelector("[data-nonogram-preview-grid]").innerHTML="",this.drawPreview("userSolution")}},{key:"_showPuzzleSolved",value:function(){var e=this.gridContainer.querySelector(".nonogram-puzzle-grid"),t=document.querySelectorAll("[data-nonogram-puzzle-grid-table] .puzzle-cell"),n=document.querySelector("[data-nonogram-puzzle-grid-solved]");t.forEach(function(e){e.classList.remove("row-column-highlight")}),e.classList.add("solved"),n.textContent="Solved!"}},{key:"_getTemplate",value:function(e){var t=this.templates.find(function(t){return t.name===e});if(!(t instanceof p))throw'"'+e+'" template not found.';return t}}])&&v(t.prototype,n),o&&v(t,o),e}();n.d(t,"Puzzle",function(){return r}),n.d(t,"Creator",function(){return g}),n.d(t,"Solver",function(){return c}),n.d(t,"Gui",function(){return z})}])});
//# sourceMappingURL=nonogram.js.map